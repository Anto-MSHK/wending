# Story 2.4: Guest Questionnaire

Status: review

## Story

As a Guest,
I want to answer additional questions about my preferences (menu, allergies, alcohol, transfer),
So that the hosts can plan the event and catering according to my needs.

## Context

The current RSVP flow allows guests to confirm attendance (Yes/No) for each household member. This story extends the flow by adding a questionnaire section that collects additional information needed for event planning:

- **Menu preferences** (choice of main course)
- **Food allergies / dietary restrictions** (critical for safety)
- **Alcohol preferences** (multi-select, budget and inventory planning)
- **Transfer needs** (logistics and transportation)

> [!IMPORTANT]
> **Data Applies Per-Guest vs Per-Household:**
> - **Menu**: Per-guest (each person may prefer different dish)
> - **Allergies**: Per-guest (safety critical ‚Äî each person's restrictions matter)
> - **Alcohol**: Per-guest (individual preferences)
> - **Transfer**: Per-household (family travels together)
>
> When opened by a Head of Household (HoH), the UI allows selecting options for *each* attending member in a streamlined form.

## Acceptance Criteria

1. **Given** The user confirms "Yes" for at least one household member
   **When** They complete RSVP selection (any "Yes" response)
   **Then** A "Questionnaire" section smoothly appears below (progressive disclosure)
   **And** All questions are optional (can be skipped)

2. **Given** The page is opened by a Head of Household with multiple attending members
   **When** They view the questionnaire
   **Then** They see a card for each attending guest with individual options
   **And** Guest names are displayed above each card
   **And** Selections are saved per-guest

3. **Given** The questionnaire is displayed
   **When** The user selects a menu option for a guest
   **Then** Options include: "ü•© –ú—è—Å–æ" (Meat), "üêü –†—ã–±–∞" (Fish), "ü•ó –í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ" (Vegetarian)
   **And** If guest is a child (age < 12), show additional "üçù –î–µ—Ç—Å–∫–æ–µ –º–µ–Ω—é" (Kids Menu) option
   **And** Selection auto-saves with visual confirmation

4. **Given** The questionnaire is displayed
   **When** The user enters allergy information for a guest
   **Then** They see a friendly prompt: "–ï—Å—Ç—å –ª–∏ –ø–∏—â–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è?" (Any dietary restrictions?)
   **And** They can select common allergens via checkboxes: –û—Ä–µ—Ö–∏ (nuts), –ú–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã (seafood), –ì–ª—é—Ç–µ–Ω (gluten), –õ–∞–∫—Ç–æ–∑–∞ (lactose)
   **And** They can enter custom text in "–î—Ä—É–≥–æ–µ" (Other) field
   **And** "–ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π" (No restrictions) option is available to explicitly indicate no allergies
   **And** Data auto-saves per guest

5. **Given** The questionnaire is displayed
   **When** The user selects alcohol preferences for a guest
   **Then** Options include: "üç∑ –í–∏–Ω–æ", "ü•Ç –®–∞–º–ø–∞–Ω—Å–∫–æ–µ", "ü•É –ö—Ä–µ–ø–∫–∏–µ –Ω–∞–ø–∏—Ç–∫–∏", "üö´ –ë–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–µ"
   **And** MULTI-SELECT is allowed (can choose wine AND champagne AND spirits)
   **And** Selecting "üö´ –ë–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–µ" deselects other options (mutually exclusive)
   **And** Data auto-saves per guest

6. **Given** The questionnaire is displayed
   **When** The user answers transfer question
   **Then** Options include: "üöå –î–∞, –Ω—É–∂–µ–Ω —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä" / "üöó –ù–µ—Ç, –ø—Ä–∏–µ–¥—É —Å–∞–º"
   **And** This is shown ONCE per household (not per guest) 
   **And** A helper text explains: "–¢—Ä–∞–Ω—Å—Ñ–µ—Ä –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ–π —Å–µ–º—å–∏"

7. **Given** Any questionnaire data is saved
   **When** The host views the Admin Dashboard
   **Then** They can see all questionnaire responses per guest
   **And** Allergies are highlighted in a warning color for visibility

## Tasks / Subtasks

- [x] Extend Guest Model (`src/models/Guest.ts`) (AC: 3, 4, 5)
  - [x] Add `menuChoice: 'meat' | 'fish' | 'vegetarian' | 'kids' | null`
  - [x] Add `allergies: string[]` (array of allergen keys: 'nuts', 'seafood', 'gluten', 'lactose')
  - [x] Add `allergiesOther: string` (custom text)
  - [x] Add `hasNoAllergies: boolean` (explicit "no allergies" confirmation)
  - [x] Add `alcoholPreferences: string[]` (multi-select: 'wine', 'champagne', 'spirits', 'none')
  - [x] Keep existing `dietaryRestrictions` for backward compatibility

- [x] Extend Household Model (`src/models/Household.ts`) (AC: 6)
  - [x] Add `needsTransfer: boolean | null` (null = not answered yet)
  - [x] Add `transferPickupLocation: string` (optional, for custom pickup notes)

- [x] Create GuestQuestionnaireSection Component (`src/components/questionnaire/GuestQuestionnaireSection.tsx`) (AC: 1)
  - [x] Only display if at least one guest has `isAttending: true`
  - [x] Section header: "üçΩÔ∏è –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤" with romantic styling
  - [x] Animate appearance with fade-in after RSVP confirmation
  - [x] Subtitle: "–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∞–∑–¥–Ω–∏–∫ –∏–¥–µ–∞–ª—å–Ω—ã–º –¥–ª—è –≤–∞—Å" (To make the celebration perfect for you)

- [x] Create GuestPreferenceCard Component (`src/components/questionnaire/GuestPreferenceCard.tsx`) (AC: 2, 3, 4, 5)
  - [x] Display guest name at the top of the card
  - [x] Contains MenuChoice, AllergyInput, and AlcoholPreference sections
  - [x] Each section is visually separated with dividers
  - [x] Unified card design per guest (not separate cards per question)

- [x] Create MenuChoiceButtons Component (`src/components/questionnaire/MenuChoiceButtons.tsx`) (AC: 3)
  - [x] Three or four emoji buttons depending on guest age:
    - ü•© –ú—è—Å–æ (Meat)
    - üêü –†—ã–±–∞ (Fish)
    - ü•ó –í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ (Vegetarian)
    - üçù –î–µ—Ç—Å–∫–æ–µ (Kids) ‚Äî shown only if `guest.age < 12`
  - [x] Toggle behavior with single selection
  - [x] Auto-save on selection with subtle checkmark animation

- [x] Create AllergyInput Component (`src/components/questionnaire/AllergyInput.tsx`) (AC: 4)
  - [x] Friendly header: "–ü–∏—â–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è"
  - [x] Quick-select checkboxes for common allergens:
    - [x] ü•ú –û—Ä–µ—Ö–∏ (nuts)
    - [x] ü¶ê –ú–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã (seafood)
    - [x] üåæ –ì–ª—é—Ç–µ–Ω (gluten)
    - [x] ü•õ –õ–∞–∫—Ç–æ–∑–∞ (lactose)
  - [x] "–ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π ‚úì" button that clears all checkboxes
  - [x] "–î—Ä—É–≥–æ–µ" text input for custom allergies (debounced auto-save)

- [x] Create AlcoholPreferenceButtons Component (`src/components/questionnaire/AlcoholPreferenceButtons.tsx`) (AC: 5)
  - [x] Four emoji toggle buttons (multi-select):
    - üç∑ –í–∏–Ω–æ (Wine)
    - ü•Ç –®–∞–º–ø–∞–Ω—Å–∫–æ–µ (Champagne)
    - ü•É –ö—Ä–µ–ø–∫–∏–µ (Spirits)
    - üö´ –ë–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–µ (Non-alcoholic)
  - [x] "–ë–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–µ" is mutually exclusive ‚Äî selecting it deselects others
  - [x] Selecting any alcohol option deselects "–ë–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω–æ–µ"
  - [x] Auto-save on each toggle

- [x] Create TransferCard Component (`src/components/questionnaire/TransferCard.tsx`) (AC: 6)
  - [x] Displayed ONCE per household (not per guest)
  - [x] Header: "üöå –¢—Ä–∞–Ω—Å—Ñ–µ—Ä"
  - [x] Helper text: "–ù—É–∂–µ–Ω –ª–∏ –≤–∞—à–µ–π —Å–µ–º—å–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –¥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞?"
  - [x] Two buttons: "–î–∞, –Ω—É–∂–µ–Ω" / "–ù–µ—Ç, –ø—Ä–∏–µ–¥–µ–º —Å–∞–º–∏"
  - [x] Note below: "–ú—ã –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –æ—Ç [location] –≤ [time]" (configurable)

- [x] Create Server Actions (`src/actions/questionnaire.actions.ts`)
  - [x] `updateGuestMenu(guestId, menuChoice)` ‚Äî updates single guest
  - [x] `updateGuestAllergies(guestId, allergies[], allergiesOther, hasNoAllergies)` ‚Äî updates single guest
  - [x] `updateGuestAlcohol(guestId, alcoholPreferences[])` ‚Äî updates single guest (with toggle logic for 'none')
  - [x] `updateHouseholdTransfer(householdId, needsTransfer)` ‚Äî household-level

- [x] Integrate into Landing Page (`src/app/(public)/page.tsx`) (AC: 1)
  - [x] Add GuestQuestionnaireSection after RSVPSection
  - [x] Conditionally render based on attendance status
  - [ ] Smooth scroll behavior after RSVP completion (deferred - requires RSVP integration)

- [ ] Update Admin Dashboard (`src/app/(admin)/page.tsx`) (AC: 7)
  - [ ] Add columns/details for menu, allergies, alcohol, transfer
  - [ ] Highlight allergy cells in amber/warning color
  - [ ] Add export functionality for catering planning (CSV/JSON)
  - **BLOCKED**: Admin dashboard page does not exist yet - requires separate story to create admin interface

## UX Specifications

### Visual Design

| Token | Value | Usage |
|-------|-------|-------|
| `cream` | `#FFF8F0` | Section background |
| `gold` | `#D4AF76` | Section headers, accents |
| `blush` | `#F8B4C0` | Selected options |
| `sage` | `#B8C9A8` | Success states, "No allergies" |
| `amber` | `#F59E0B` | Allergy warnings in admin |
| `charcoal` | `#3D3D3D` | Primary text |

### Typography

- **Section Header**: Cormorant Garamond, 1.5rem (24px)
- **Guest Names**: Inter, 1.125rem (18px), semi-bold
- **Option Labels**: Inter, 1rem (16px)
- **Helper Text**: Inter, 0.875rem (14px), muted

### Per-Guest Card Layout

Since menus, allergies, and alcohol are per-guest, each attending guest gets their own card:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                         ‚îÇ
‚îÇ           üçΩÔ∏è –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤                         ‚îÇ
‚îÇ      –ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∞–∑–¥–Ω–∏–∫ –∏–¥–µ–∞–ª—å–Ω—ã–º –¥–ª—è –≤–∞—Å          ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  üë§ –°–µ—Ä–≥–µ–π                                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –ú–µ–Ω—é:                                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  [ü•© –ú—è—Å–æ]   [üêü –†—ã–±–∞]   [ü•ó –í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ]       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –ù–∞–ø–∏—Ç–∫–∏:                                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  [üç∑]  [ü•Ç]  [ü•É]  [üö´ –ë–µ–∑ –∞–ª–∫–æ–≥–æ–ª—è]               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –ü–∏—â–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  [ ] ü•ú  [ ] ü¶ê  [ ] üåæ  [ ] ü•õ   [‚úì –ù–µ—Ç]          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –î—Ä—É–≥–æ–µ: [_______________]                        ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  üë§ –ï–ª–µ–Ω–∞                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  (same structure as above)                        ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  üë§ –ú–∞—à–∞ (—Ä–µ–±—ë–Ω–æ–∫)                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –ú–µ–Ω—é:                                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  [ü•©]  [üêü]  [ü•ó]  [üçù –î–µ—Ç—Å–∫–æ–µ –º–µ–Ω—é]               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ...                                              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  üöå –¢—Ä–∞–Ω—Å—Ñ–µ—Ä                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –ù—É–∂–µ–Ω –ª–∏ –≤–∞—à–µ–π —Å–µ–º—å–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –¥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞?       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  [–î–∞, –Ω—É–∂–µ–Ω]     [–ù–µ—Ç, –ø—Ä–∏–µ–¥–µ–º —Å–∞–º–∏]              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚ÑπÔ∏è –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –≥–æ—Ä–æ–¥–∞ –≤ 14:00              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Interaction States

| State | Description | Visual |
|-------|-------------|--------|
| **Initial** | No selections | All buttons muted/outlined |
| **Selected** | User made choice | Button filled with `blush` |
| **Multi-selected** | Multiple alcohol options | Multiple filled buttons |
| **Saving** | Auto-save in progress | Subtle spinner on button |
| **Saved** | Data persisted | Brief ‚úì checkmark flash (300ms) |
| **Exclusive** | "No alcohol" mode | Other options visually disabled |
| **Error** | Save failed | Shake animation, toast message |

### Progressive Disclosure Flow

```mermaid
flowchart TD
    A[Guest Opens Page] --> B[Sees RSVP Section]
    B --> C{Selects any Yes?}
    C -->|No| D[Questionnaire Hidden]
    C -->|Yes| E[Questionnaire Fades In]
    E --> F[Per-Guest Cards Appear]
    F --> G[Transfer Card at Bottom]
```

### Micro-Animations

- **Section Appear**: Fade-in + slide-up (400ms ease-out)
- **Button Select**: Scale pulse (1.0 ‚Üí 1.05 ‚Üí 1.0) + color fill
- **Save Confirm**: Checkmark icon fades in (150ms), stays (200ms), fades out (150ms)
- **Error Shake**: Horizontal shake (-5px, 5px) √ó 3 cycles

### Accessibility

- Touch targets: minimum 48x48px
- Color contrast: WCAG AA (4.5:1)
- ARIA labels for screen readers (e.g., `aria-pressed` for toggle buttons)
- Keyboard navigation support (Tab, Enter/Space to toggle)
- Focus states visible with gold outline

## Dev Notes

### Architecture Compliance

- **Client Components**: All questionnaire components need `"use client"`
- **Server Actions**: Return `ActionResponse<T>` pattern
- **Auto-save**: Use `useTransition` + debounce (500ms) for text inputs
- **No Submit Button**: Per UX anti-patterns, use auto-save for all fields
- **Per-Guest Logic**: Server actions update individual guests, not bulk operations

### Data Flow

```
page.tsx (Server)
    ‚Üì fetches guests + household
    ‚Üì passes guest list with ages
GuestQuestionnaireSection (Client)
    ‚Üì conditionally renders if any attending
    ‚Üì maps over attending guests
GuestPreferenceCard (Client, per guest)
    ‚Üì contains MenuChoice, Alcohol, Allergy inputs
    ‚Üì each calls individual server actions
TransferCard (Client, once per household)
    ‚Üì calls household-level server action
```

### Edge Cases

- **Single Guest Household**: Show one card, no "family" wording
- **All Declined**: Hide questionnaire entirely
- **Guest Changes RSVP to No**: Hide their questionnaire card, keep data in DB
- **Guest Changes RSVP back to Yes**: Re-show card with previously saved data
- **Child Detection**: Use `guest.age < 12` to show kids menu option

## References

- [Guest Model](file:///e:/WebDev/wedding/src/models/Guest.ts)
- [Household Model](file:///e:/WebDev/wedding/src/models/Household.ts)
- [Story 2.1 RSVP UI](file:///e:/WebDev/wedding/_bmad-output/implementation-artifacts/2.1-rsvp-ui-component.md)
- [RSVPSection Component](file:///e:/WebDev/wedding/src/components/rsvp/RSVPSection.tsx)
- [Architecture](file:///e:/WebDev/wedding/_bmad-output/planning-artifacts/architecture.md)

## Dev Agent Record

### Agent Model Used

Gemini (Antigravity)

### Completion Notes List

- **2026-01-24**: Implemented complete questionnaire flow (10 of 11 tasks)
  - Extended Guest model with 5 questionnaire fields: `menuChoice`, `allergies`, `allergiesOther`, `hasNoAllergies`, `alcoholPreferences`
  - Extended Household model with 2 transfer fields: `needsTransfer`, `transferPickupLocation`
  - Created 4 server actions with validation and optimistic UI support
  - Created 6 UI components with auto-save, animations, and mutual exclusivity logic
  - Integrated into landing page with conditional rendering
  - **Admin Dashboard (AC7) BLOCKED**: No admin page exists yet - requires separate story

### File List

**New Files:**
- `src/components/questionnaire/types.ts`
- `src/components/questionnaire/MenuChoiceButtons.tsx`
- `src/components/questionnaire/AllergyInput.tsx`
- `src/components/questionnaire/AlcoholPreferenceButtons.tsx`
- `src/components/questionnaire/TransferCard.tsx`
- `src/components/questionnaire/GuestPreferenceCard.tsx`
- `src/components/questionnaire/GuestQuestionnaireSection.tsx`
- `src/actions/questionnaire.actions.ts`

**Modified Files:**
- `src/models/Guest.ts` - Added questionnaire fields
- `src/models/Household.ts` - Added transfer fields
- `src/actions/types.ts` - Added result types
- `src/app/(public)/page.tsx` - Integrated questionnaire

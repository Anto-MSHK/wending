# Story 1.6: Scroll-Driven Path Animation with Heart Marker

Status: ready-for-dev

## Story

As a Guest,
I want to see an animated heart moving along curved paths between venues as I scroll,
So that I can visually experience the wedding day journey in a romantic and engaging way.

## Acceptance Criteria

1. **Given** The user scrolls to the Map section
2. **When** They begin scrolling through Stage 1 (ЗАГС)
3. **Then** A **curved path (bezier line)** appears connecting ЗАГС → Храм
4. **And** A **heart icon (❤️)** starts at ЗАГС position
5. **And** As the user scrolls, the heart **smoothly moves along the curved path** toward Храм
6. **When** The heart reaches Храм (scroll threshold ~35%)
7. **Then** The heart **stays at Храм** as a static marker
8. **And** A new **curved path** appears from Храм → Ресторан
9. **And** On further scrolling, the heart moves along this second path
10. **When** The heart reaches Ресторан (scroll threshold ~68%)
11. **Then** The heart **stays at Ресторан** as the final marker

## Visual Specifications

### Path Design

| Property | Value |
|----------|-------|
| **Type** | SVG curved path (Quadratic or Cubic Bezier) |
| **Color** | Gold gradient (`#D4AF76` → `#e9c675`) |
| **Width** | 3-4px |
| **Style** | Solid line with subtle glow/shadow |
| **Animation** | Path "draws in" or fades in when section becomes active |

### Heart Marker Design

| Property | Value |
|----------|-------|
| **Icon** | Heart (❤️ or custom SVG) |
| **Size** | 32-40px |
| **Color** | Blush/Gold gradient (`#F8B4C0` → `#D4AF76`) |
| **Animation** | Slight pulse/glow effect while moving |
| **Shadow** | Soft drop shadow for depth |

### Path Curves

```
ЗАГС (47.107977, 39.419287)
   ↓
   ╰──────╮  (curve control point offset)
          ╰→ Храм (47.1069, 39.4125)
                ↓
                ╰────────────────╮  (longer curve for ~15 min drive)
                                 ╰→ Ресторан (47.111626, 39.441170)
```

## Technical Implementation

### SVG Overlay Layer

- Create an SVG layer positioned absolutely over the Leaflet map
- SVG must match map container dimensions
- Convert geo-coordinates to screen coordinates using Leaflet's `latLngToContainerPoint()`
- Recalculate positions on map zoom/pan (if applicable)

### Path Animation Logic

```typescript
// Pseudo-code
interface PathSegment {
  from: LatLng;
  to: LatLng;
  controlPoint: LatLng; // For bezier curve
  scrollStart: number;  // e.g., 0
  scrollEnd: number;    // e.g., 0.35
}

const PATH_SEGMENTS: PathSegment[] = [
  { 
    from: ZAGS_COORDS, 
    to: CHURCH_COORDS, 
    controlPoint: { lat: 47.107, lng: 39.416 }, // Offset for curve
    scrollStart: 0, 
    scrollEnd: 0.35 
  },
  { 
    from: CHURCH_COORDS, 
    to: RESTAURANT_COORDS, 
    controlPoint: { lat: 47.109, lng: 39.427 },
    scrollStart: 0.35, 
    scrollEnd: 0.68 
  }
];

// Calculate heart position based on scroll progress
function getHeartPosition(scrollProgress: number): LatLng {
  const segment = getActiveSegment(scrollProgress);
  const segmentProgress = normalizeProgress(scrollProgress, segment);
  return getPointOnBezier(segment, segmentProgress);
}
```

### Bezier Curve Calculation

```typescript
// Quadratic Bezier: B(t) = (1-t)²P0 + 2(1-t)tP1 + t²P2
function getPointOnQuadraticBezier(
  p0: Point,  // Start
  p1: Point,  // Control
  p2: Point,  // End
  t: number   // Progress 0-1
): Point {
  const x = (1-t)*(1-t)*p0.x + 2*(1-t)*t*p1.x + t*t*p2.x;
  const y = (1-t)*(1-t)*p0.y + 2*(1-t)*t*p1.y + t*t*p2.y;
  return { x, y };
}
```

## Tasks / Subtasks

### 1. Create SVG Overlay Component
- [ ] Create `PathOverlay.tsx` component
- [ ] Position SVG layer absolutely over map
- [ ] Handle coordinate conversion (geo → screen)
- [ ] Subscribe to scroll progress from parent

### 2. Implement Curved Paths
- [ ] Define bezier control points for each segment
- [ ] Draw SVG `<path>` elements with `d="M... Q..."` or `d="M... C..."`
- [ ] Apply gold gradient stroke
- [ ] Add subtle glow effect (`filter: drop-shadow`)

### 3. Implement Heart Marker
- [ ] Create heart SVG or use emoji with styling
- [ ] Calculate position along bezier curve based on scroll progress
- [ ] Apply transform to move heart smoothly
- [ ] Add pulse/glow animation while moving

### 4. Path Reveal Animation
- [ ] Path 1 (ЗАГС → Храм): Visible when `scrollProgress > 0`
- [ ] Path 2 (Храм → Ресторан): Visible when `scrollProgress > 0.35`
- [ ] Use CSS `stroke-dasharray` + `stroke-dashoffset` for draw-in effect (optional)

### 5. State Management
- [ ] Track which paths are revealed
- [ ] Calculate heart position based on active segment + progress
- [ ] Handle edge cases (heart at start, heart at end)

### 6. Integration
- [ ] Integrate `PathOverlay` into `ScrollDrivenMap.tsx`
- [ ] Remove or update existing static markers
- [ ] Test on mobile and desktop
- [ ] Ensure accessibility (decorative, `aria-hidden`)

## Open Questions

1. **Control point offsets**: Need to fine-tune bezier control points for natural curves — may require visual testing
2. **Performance**: SVG updates on every scroll frame — consider `requestAnimationFrame` throttling if needed
3. **Map zoom interaction**: If map zooms/pans, paths need recalculation — current implementation is static zoom

## Dependencies

- [Story 1.5: Scroll-Driven Interactive Map](file:///e:/WebDev/wedding/_bmad-output/implementation-artifacts/1.5-interactive-location-roadmap.md) — Base implementation

## Dev Notes

- Use `useRef` for SVG element to optimize re-renders
- Consider using `framer-motion` for smooth path transitions if native CSS insufficient
- Heart marker replaces the current gold dot markers — simplifies visual hierarchy
